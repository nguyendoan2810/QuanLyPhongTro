<!-- Modal thêm dịch vụ -->
<div id="serviceModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4 modal-backdrop">
    <div class="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto bounce-in">
        <!-- Header -->
        <div class="p-6 border-b border-gray-200 flex justify-between items-center">
            <h3 class="text-lg font-semibold text-gray-800">Thêm dịch vụ mới</h3>
            <button onclick="closeModal('serviceModal')" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <!-- Form -->
        <div class="p-6">
            <form id="serviceForm" class="space-y-4">
                @Html.AntiForgeryToken()

                <div>
                    <label for="TenDv" class="block text-sm font-medium text-gray-700 mb-2">Tên dịch vụ *</label>
                    <input id="TenDv" name="TenDv" type="text" class="form-input w-full px-3 py-2 rounded-lg border" required>
                </div>

                <div>
                    <label for="DonGia" class="block text-sm font-medium text-gray-700 mb-2">Đơn giá (VNĐ) *</label>
                    <input id="DonGia" name="DonGia" type="number" min="1" class="form-input w-full px-3 py-2 rounded-lg border" required>
                </div>
            </form>
        </div>

        <!-- Footer -->
        <div class="p-6 border-t border-gray-200 flex justify-end space-x-3">
            <button onclick="closeModal('serviceModal')" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg">Hủy</button>
            <button id="saveServiceBtn" type="button" class="btn-primary px-4 py-2 bg-blue-600 text-white rounded-lg">Lưu</button>
        </div>
    </div>
</div>

<!-- Script thêm dịch vụ -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const saveBtn = document.getElementById("saveServiceBtn");

        saveBtn.addEventListener("click", function () {
            const form = document.getElementById("serviceForm");
            const tenDv = form.TenDv.value.trim();
            const donGia = parseFloat(form.DonGia.value);
            const token = form.querySelector('input[name="__RequestVerificationToken"]').value;

            if (!tenDv || isNaN(donGia) || donGia <= 0) {
                showNotification("Vui lòng nhập đầy đủ và hợp lệ!", "error");
                return;
            }

            $.ajax({
                url: '/QuanLy/DichVu/Create',
                method: 'POST',
                headers: { 'RequestVerificationToken': token },
                data: { TenDv: tenDv, DonGia: donGia },
                success: function (res) {
                    if (res.success) {
                        showNotification('Thêm dịch vụ thành công!', 'success');
                        closeModal('serviceModal');
                        reloadDichVuList(); // tải lại danh sách
                    } else {
                        showNotification(res.message || 'Có lỗi xảy ra khi thêm dịch vụ!', 'error');
                    }
                },
                error: function (xhr) {
                    console.error('Lỗi:', xhr.responseText);
                    showNotification('Lỗi: ' + xhr.responseText, 'error');
                }
            });
        });
    });
</script>
